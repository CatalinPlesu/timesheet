services:
  bot:
    image: ghcr.io/${REPO_OWNER:-catalogin}/timesheet-bot:${IMAGE_TAG:-latest}
    container_name: timesheet-telegram-bot
    restart: unless-stopped
    volumes:
      - ./data:/app/data
    environment:
      - DOTNET_ENVIRONMENT=Production
      - Database__ConnectionString=Data Source=/app/data/timesheet.db
      - Database__EnableSensitiveDataLogging=false
      - Database__EnableDetailedErrors=false
      - Bot__Token=${BOT_TOKEN}
      - FrontendUrl=${FRONTEND_EXTERNAL_URL:-http://localhost:3000}
      - EmployerApi__BaseUrl=${EMPLOYER_API_BASE_URL:-}
      - EmployerApi__AttendanceEndpoint=/api/TimeOff/getEmployeeAttendance
      - Workers__AutoShutdownCheckInterval=${AUTO_SHUTDOWN_CHECK_INTERVAL:-00:03:00}
      - Workers__ForgotShutdownCheckInterval=${FORGOT_SHUTDOWN_CHECK_INTERVAL:-00:03:00}
      - Workers__LunchReminderCheckInterval=${LUNCH_REMINDER_CHECK_INTERVAL:-00:03:00}
      - Workers__WorkHoursAlertCheckInterval=${WORK_HOURS_ALERT_CHECK_INTERVAL:-00:03:00}
    networks:
      - timesheet-network

  api:
    image: ghcr.io/${REPO_OWNER:-catalogin}/timesheet-api:${IMAGE_TAG:-latest}
    container_name: timesheet-api
    restart: unless-stopped
    ports:
      - "${API_PORT:-5000}:5000"
    volumes:
      - ./data:/app/data
    environment:
      - DOTNET_ENVIRONMENT=Production
      - ASPNETCORE_URLS=http://+:5000
      - Database__ConnectionString=Data Source=/app/data/timesheet.db
      - Database__EnableSensitiveDataLogging=false
      - Database__EnableDetailedErrors=false
      - JwtSettings__SecretKey=${JWT_SECRET_KEY}
      - JwtSettings__Issuer=${JWT_ISSUER:-TimeSheet.API}
      - JwtSettings__Audience=${JWT_AUDIENCE:-TimeSheet.Web}
      - JwtSettings__ExpirationMinutes=${JWT_EXPIRATION_MINUTES:-60}
      - Cors__AllowedOrigins__0=http://localhost:${FRONTEND_PORT:-3000}
      - Cors__AllowedOrigins__1=${FRONTEND_EXTERNAL_URL:-http://localhost:3000}
      - FrontendUrl=${FRONTEND_EXTERNAL_URL:-http://localhost:3000}
    networks:
      - timesheet-network

  frontend:
    image: ghcr.io/${REPO_OWNER:-catalogin}/timesheet-frontend:${IMAGE_TAG:-latest}
    container_name: timesheet-frontend
    restart: unless-stopped
    ports:
      - "${FRONTEND_PORT:-3000}:80"
    networks:
      - timesheet-network

networks:
  timesheet-network:
    driver: bridge
